<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="utf-8" />
	<title>Smooth Keyboard Control</title>
	
</head>
<body>
<script src="https://cdnjs.cloudflare.com/ajax/libs/pixi.js/4.7.3/pixi.min.js"></script>
<script src="js/keys.js"></script>
<script src="js/classes.js"></script>
<script src="js/utilities.js"></script>
<script>

const app = new PIXI.Application(600,400);
document.body.appendChild(app.view); 
let avatar;
	
let platforms = [];


window.onload = ()=>{
	avatar = new Avatar(10,0x00FF00,300,200);
	app.stage.addChild(avatar);
	
	let platform1 = new Platform(100, 10, 0xFF0000, 100, 150);
	app.stage.addChild(platform1);
	
	let platform2 = new Platform(100, 10, 0xFF0000, 200, 100);
	app.stage.addChild(platform2);
	
	platforms.push(platform1);
	platforms.push(platform2);
	
	app.renderer.backgroundColor = 0x5d5d5d;

	// Animation Loop
	app.ticker.add(()=>{
		// #1 - Calculate "delta time"
		let dt = 1/app.ticker.FPS;
		if (dt > 1/12) dt=1/12;
		
		// #2 - Check Keys
		if(keys[keyboard.RIGHT]){
			avatar.dx += avatar.speed;
		}else if(keys[keyboard.LEFT]) {
			avatar.dx += -avatar.speed;
		}else if (avatar.dx != 0){
			avatar.dx -= 3 * (avatar.dx * dt);
			if(Math.abs(avatar.dx) < 1){
			   avatar.dx = 0;
			}
		}
		
		if(keys[keyboard.UP] && avatar.isGrounded) {
			avatar.dy -= clamp(avatar.dy, 350, 350);
		}
		
		// #3 - move avatar
		avatar.update(dt, app.view.width, app.view.height);
		
		
		for(let i = 0; i < platforms.length; i++){
			if(rectsIntersect(avatar, platforms[i])){
				avatar.y -= platforms[i].height/2;
				avatar.dy = -avatar.dy/2;
				avatar.isGrounded = true;
				
				if(keys[keyboard.DOWN]) {
					avatar.y += 12;
				}
				
				console.log("Collision!");
			}
		}
	
	});
	
} // end window.onload



</script>
</body>
</html>